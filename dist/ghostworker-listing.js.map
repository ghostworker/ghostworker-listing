{"version":3,"file":null,"sources":["../lib/ghostworker-listing.js"],"sourcesContent":["\nvar GhostWorkerListing = {};\n\nvar GhostWorkerListing = {};\n\nGhostWorkerListing.listContent = function (selector, cacheName) {\n\n    var self = this;\n    var cacheName = this.buildCacheName(cacheName);\n    var parentNode = document.querySelector(selector);\n\n    return caches.open(cacheName).then(function (cache) {\n        return cache.keys().then(function (keys) {\n            return Promise.all(keys.map(self.readCacheItem)).then(function (results) {\n                //console.log(results.length);\n\n                results.sort(self.sortBy('cachedDate', true));\n                results.forEach(function (item) {\n                    if (!item.error) {\n                        self.renderItem(item.body, item.response, item.request, parentNode);\n                    }\n                });\n                return results;\n            });\n        });\n    });\n};\n\nGhostWorkerListing.readCacheItem = function (request) {\n\n    var clonedRequest = request.clone();\n    return window.caches.match(clonedRequest).then(function (response) {\n\n        if (response) {\n            var clonedResponse = response.clone();\n            return clonedResponse.text().then(function (body) {\n\n                var out = {\n                    'body': body,\n                    'response': clonedResponse,\n                    'request': clonedRequest\n                };\n\n                if (request.headers) {\n                    var isodate = request.headers.get('X-Ghost-Worker-Cache-Date');\n                    if (isodate) {\n                        out.cachedDate = isodate;\n                    }\n                }\n                return out;\n            });\n        } else {\n            return { 'error': 'No response object found for cache item' };\n        }\n    });\n};\n\nGhostWorkerListing.renderItem = function (body, response, request, parentNode) {\n\n    var json = JSON.parse(body);\n\n    var li = document.createElement('li');\n    li.classList.add('cache-item');\n    var a = document.createElement('a');\n    var title = json.replacements[0].content[0].replace('<title>', '').replace('</title>', '');\n\n    a.appendChild(document.createTextNode(title));\n    a.href = this.urlRemovePathElement(request.url, '-json');\n    li.appendChild(a);\n\n    if (request.headers) {\n        var isodate = request.headers.get('X-Ghost-Worker-Cache-Date');\n        var timeContainer = document.createElement('span');\n        var timeLabel = document.createElement('span');\n        timeContainer.classList.add('cache-item-time-container');\n        timeLabel.classList.add('cache-item-time-label');\n        var time = document.createElement('time');\n        time.setAttribute('datetime', isodate);\n        var formatted = moment(isodate).format('Do MMMM YYYY - hh:mm:ss');\n\n        time.appendChild(document.createTextNode(formatted));\n        timeLabel.appendChild(document.createTextNode('Last cached: '));\n        li.appendChild(document.createTextNode(' '));\n\n        timeContainer.appendChild(timeLabel);\n        timeContainer.appendChild(time);\n        li.appendChild(timeContainer);\n    }\n\n    parentNode.appendChild(li);\n};\n\nGhostWorkerListing.urlRemovePathElement = function (url, pathElement) {\n    url = new URL(url);\n    url.pathname = url.pathname.replace(pathElement, '');\n    return url.toString();\n};\n\nGhostWorkerListing.buildCacheName = function (name) {\n    return 'ghostworker-' + name + '-v0.1';\n};\n\nGhostWorkerListing.sortBy = function (field, reverse, primer) {\n\n    var key = primer ? function (x) {\n        return primer(x[field]);\n    } : function (x) {\n        return x[field];\n    };\n\n    reverse = !reverse ? 1 : -1;\n\n    return function (a, b) {\n        return a = key(a), b = key(b), reverse * ((a > b) - (b > a));\n    };\n};\n\nexport default GhostWorkerListing;\n\n"],"names":["GhostWorkerListing","listContent","selector","cacheName","self","buildCacheName","parentNode","document","querySelector","caches","open","then","cache","keys","Promise","all","map","readCacheItem","results","sort","sortBy","forEach","item","error","renderItem","body","response","request","clonedRequest","clone","window","match","clonedResponse","text","out","headers","isodate","get","cachedDate","json","JSON","parse","li","createElement","classList","add","a","title","replacements","content","replace","appendChild","createTextNode","href","urlRemovePathElement","url","timeContainer","timeLabel","time","setAttribute","formatted","moment","format","pathElement","URL","pathname","toString","name","field","reverse","primer","key","x","b"],"mappings":"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"}